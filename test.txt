async def _azure_generate_with_image_async(prompt_text, img_bytes, img_ext):
    """
    Uses AsyncAzureOpenAI (official openai package) to call chat.completions.create
    with the prompt + image (base64 embedded in the text).
    """
    import base64
    image_b64 = base64.b64encode(img_bytes).decode()

    messages = [
        {"role": "user", "content": prompt_text + f"\n\n[IMAGE_BASE64:{image_b64}]"}
    ]

    resp = await openai_llm.chat.completions.create(
        model=MODEL,
        messages=messages
    )

    # Normalize and return response text
    if hasattr(resp, "choices") and len(resp.choices) > 0:
        first = resp.choices[0]
        if hasattr(first, "message") and hasattr(first.message, "content"):
            return first.message.content
    return str(resp)
